<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tool Return Form</title>
  <style>
    body { margin: 0; font-family: sans-serif; background: #eee; }
    .container {
      position: relative;
      width: 1012px;
      margin: 2em auto;
      background: white;
      background-image: url('9be7eced-f929-4f20-854d-ccc8ec549328.png');
      background-size: cover;
      background-repeat: no-repeat;
      height: 987px;
    }
    .input-field, .signature {
      position: absolute;
      font-size: 16px;
      padding: 2px;
      border: 1px solid #ccc;
      background: rgba(255,255,255,0.8);
    }
    .signature-pad {
      position: absolute;
      border: 1px solid #ccc;
      background: white;
    }
    #shareBtn { display: block; margin: 20px auto; padding: 10px 20px; font-size: 16px; }
  </style>
</head>
<body>
  <div class="container" id="formContainer">
    <textarea class="input-field" style="top: 85px; left: 250px; width: 200px; height: 20px;" placeholder="Date"></textarea>
    <textarea class="input-field" style="top: 110px; left: 250px; width: 200px; height: 20px;" placeholder="Time"></textarea>
    <textarea class="input-field" style="top: 135px; left: 250px; width: 500px; height: 20px;" placeholder="Location"></textarea>

    <textarea class="input-field" style="top: 190px; left: 20px; width: 950px; height: 60px;" placeholder="Description of Equipment"></textarea>
    <textarea class="input-field" style="top: 270px; left: 20px; width: 950px; height: 60px;" placeholder="Description of Damage/Loss"></textarea>
    <textarea class="input-field" style="top: 350px; left: 20px; width: 950px; height: 40px;" placeholder="Witnesses"></textarea>
    <textarea class="input-field" style="top: 410px; left: 20px; width: 950px; height: 40px;" placeholder="Notes"></textarea>

    <canvas class="signature-pad" id="employeeSig" width="300" height="60" style="top: 620px; left: 40px;"></canvas>
    <canvas class="signature-pad" id="supervisorSig" width="300" height="60" style="top: 620px; left: 550px;"></canvas>
  </div>

  <button id="shareBtn">Export Form & Share</button>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    const canvas1 = document.getElementById('employeeSig');
    const canvas2 = document.getElementById('supervisorSig');
    const sig1 = canvas1.getContext('2d');
    const sig2 = canvas2.getContext('2d');
    let drawing = false;

    [canvas1, canvas2].forEach((c, i) => {
      const ctx = i === 0 ? sig1 : sig2;
      c.addEventListener('pointerdown', e => {
        drawing = true;
        ctx.beginPath();
        ctx.moveTo(e.offsetX, e.offsetY);
      });
      c.addEventListener('pointermove', e => {
        if (!drawing) return;
        ctx.lineTo(e.offsetX, e.offsetY);
        ctx.stroke();
      });
      c.addEventListener('pointerup', () => drawing = false);
    });

    document.getElementById('shareBtn').addEventListener('click', async () => {
      const container = document.getElementById('formContainer');
      const clone = container.cloneNode(true);
      const inputs = clone.querySelectorAll('textarea');
      inputs.forEach(input => {
        const span = document.createElement('div');
        span.style.position = 'absolute';
        span.style.left = input.style.left;
        span.style.top = input.style.top;
        span.style.width = input.style.width;
        span.style.height = input.style.height;
        span.style.fontSize = '16px';
        span.style.whiteSpace = 'pre-wrap';
        span.style.fontFamily = 'sans-serif';
        span.innerText = input.value;
        clone.appendChild(span);
        input.remove();
      });

      const sig1URL = canvas1.toDataURL();
      const sig2URL = canvas2.toDataURL();
      const img1 = new Image();
      const img2 = new Image();
      img1.src = sig1URL;
      img2.src = sig2URL;
      img1.style = canvas1.style;
      img2.style = canvas2.style;
      clone.appendChild(img1);
      clone.appendChild(img2);
      canvas1.remove();
      canvas2.remove();

      const pdfCanvas = await html2canvas(clone);
      const pdfData = pdfCanvas.toDataURL('image/png');
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF({ orientation: 'portrait', unit: 'px', format: [1012, 987] });
      pdf.addImage(pdfData, 'PNG', 0, 0, 1012, 987);
      pdf.save('Filled_Tool_Return_Form.pdf');
    });
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</body>
</html>
